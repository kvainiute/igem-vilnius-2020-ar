let points = [
    {
        lt: "DNR",
        en: "DNA",
        link: "dna",
        vln: {
            lt: "Vinco Kudirkos aikštė",
            en: "Vincas Kudirka Square",
            coordinates: [25.280564, 54.687349],
        },
        kns: {
            lt: "Laisvės alėjos fontanas",
            en: "Laisvės Avenue Fountain",
            coordinates: [23.91356, 54.89738]
        },
        klp: {
            lt: "Senoji perkėla",
            en: "Old Ferry",
            coordinates: [21.122890, 55.706472]
        },
        sil: {
            lt: "Geležinė lapė",
            en: "Iron Fox",
            coordinates: [23.328929, 55.931132],
        },
        pnv: {
            lt: "Skaistakalnio parkas",
            en: "Skaistakalnis Park",
            coordinates: [24.37616, 55.73379]
        },
        trg: {
            lt: "Pilies aikštė",
            en: "Castle Square",
            coordinates: [22.284634, 55.253400]
        },
        rtv: {
            lt: "Raudonieji vartai",
            en: "The Red Gate",
            coordinates: [21.934260, 55.725814]
        },
        zrs: {
            lt: "Didžiosios salos paplūdimys",
            en: "Big Island Beach",
            coordinates: [26.245028, 55.728278]
        },
        alt: {
            lt: "Alytaus miesto sodas",
            en: "Alytus City Garden",
            coordinates: [24.07707, 54.3855]
        },
        mzk: {
            lt: "Senamiesčio parkas (I)",
            en: "Old Town Park (I)",
            coordinates: [22.348743, 56.316101]
        },
    },
    {
        lt: "RNR",
        en: "RNA",
        link: "rna",
        vln: {
            lt: "Bernardinų sodas (I)",
            en: "Bernardine Garden (I)",
            coordinates: [25.297362, 54.683689],
        },
        kns: {
            lt: "Studentų skveras",
            en: "Students' Square",
            coordinates: [23.91431, 54.89897]
        },
        klp: {
            lt: "Teatro aikštė",
            en: "Theatre Square",
            coordinates: [21.13155, 55.70784]
        },
        sil: {
            lt: "Saulės laikrodžio aikštė",
            en: "The Sundial Square",
            coordinates: [23.325083, 55.930636],
        },
        pnv: {
            lt: "Laisvės aikštė",
            en: "Freedom Square",
            coordinates: [24.36228, 55.72615]
        },
        trg: {
            lt: "Muzikinis fontanas",
            en: "Musical Fountain",
            coordinates: [22.287779, 55.253310]
        },
        rtv: {
            lt: "Zarbeko alėja",
            en: "Zarbekas Alley",
            coordinates: [21.931144, 55.723730]
        },
        zrs: {
            lt: "Zaraso ežero apžvalgos ratas",
            en: "Lake Zarasai Observation Circle",
            coordinates: [26.243639, 55.728028]
        },
        alt: {
            lt: "Baltosios rožės tiltas",
            en: "Bridge of the White Rose",
            coordinates: [24.08138, 54.39313]
        },
        mzk: {
            lt: "Senamiesčio parkas (II)",
            en: "Old Town Park (II)",
            coordinates: [22.348721, 56.316470]
        },
    },
    {
        lt: "Genetinė grandinė",
        en: "Genetic circuit",
        link: "circuit",
        vln: {
            lt: "Lukiškių aikštė",
            en: "Lukiškės Square",
            coordinates: [25.271029, 54.689640],
        },
        kns: {
            lt: "Muzikinio teatro kiemelis",
            en: "Musical Theater Yard",
            coordinates: [23.90616, 54.89641]
        },
        klp: {
            lt: "Lietuvos jūrų muziejus",
            en: "Lithuanian Sea Museum",
            coordinates: [21.101346, 55.716877]
        },
        sil: {
            lt: "Koncertų salė „Saulė“",
            en: "Concert Hall \"Saulė\"",
            coordinates: [23.312699, 55.9299356],
        },
        pnv: {
            lt: "Raktų medis",
            en: "Key Tree",
            coordinates: [24.35827, 55.72926]
        },
        trg: {
            lt: "Užtvanka",
            en: "Dam",
            coordinates: [22.280021, 55.251672]
        },
        rtv: {
            lt: "Alėja prie dvaro parko tvenkinio",
            en: "Alley by the Manor Park Pond",
            coordinates: [21.933667, 55.726798]
        },
        zrs: {
            lt: "Wake Inn",
            en: "Wake Inn",
            coordinates: [26.231528, 55.735139]
        },
        alt: {
            lt: "Alytaus miesto sodas (II)",
            en: "Alytus City Garden (II)",
            coordinates: [24.04838, 54.39347]
        },
        mzk: {
            lt: "Juodpelkio parkas (I)",
            en: "Juodpelkio Park (I)",
            coordinates: [22.339610, 56.295133]
        },
    },
    {
        lt: "Biobrick",
        en: "Biobrick",
        link: "biobrick",
        vln: {
            lt: "Simono Daukanto aikštė",
            en: "Simonas Daukantas Square",
            coordinates: [25.286342, 54.683594],
        },
        kns: {
            lt: "Rožinis dramblys",
            en: "The Pink Elephant",
            coordinates: [23.90826, 54.90015]
        },
        klp: {
            lt: "Dienovidžio skveras",
            en: "Midday Square",
            coordinates: [21.13491, 55.70807]
        },
        sil: {
            lt: "Sukilėlių kalnelis",
            en: "The Hill of Rebels",
            coordinates: [23.304555, 55.935753],
        },
        pnv: {
            lt: "Kraštotyros muziejus",
            en: "Local Lore Museum",
            coordinates: [24.35838, 55.73005]
        },
        trg: {
            lt: "Švč. Trejybės bažnyčia",
            en: "Catholic Church of the Holy Trinity",
            coordinates: [22.284751, 55.249393]
        },
        rtv: {
            lt: "Skveras prie bažnyčios",
            en: "Square by the Church",
            coordinates: [21.932130, 55.722873]
        },
        zrs: {
            lt: "Žalias tiltas link Didžiosios salos",
            en: "Green Bridge towards Big Island",
            coordinates: [26.237000, 55.735806]
        },
        alt: {
            lt: "Piliakalnis",
            en: "Hillfort",
            coordinates: [24.07948, 54.39637]
        },
        mzk: {
            lt: "Juodpelkio parkas (II)",
            en: "Juodpelkio Park (II)",
            coordinates: [22.346875, 56.294752]
        },
    },
    {
        lt: "Sintetinė Biologija",
        en: "Synthetic Biology",
        link: "painting",
        vln: {
            lt: "Literatų gatvė",
            en: "Literatų Street",
            coordinates: [25.290187, 54.682223],
        },
        kns: {
            lt: "Kauno Pilis",
            en: "Kaunas Castle",
            coordinates: [23.8854, 54.89892]
        },
        klp: {
            lt: "Biržos tiltas",
            en: "Biržos Bridge",
            coordinates: [21.13343, 55.71013]
        },
        sil: {
            lt: "Autobusų stotis",
            en: "Bus Station",
            coordinates: [23.308000, 55.927814],
        },
        pnv: {
            lt: "Katedra",
            en: "Cathedral",
            coordinates: [24.3564, 55.72288]
        },
        trg: {
            lt: "Sėkmės deivės skulptūra",
            en: "Sculpture of the Goddess of Luck",
            coordinates: [22.292177, 55.252488]
        },
        rtv: {
            lt: "Buvusi dvaro oranžerija",
            en: "Former Manor Orangerie",
            coordinates: [21.933833, 55.728535]
        },
        zrs: {
            lt: "Zarasų turizmo ir verslo informacijos centras",
            en: "Zarasai Tourism and Business Information Centre",
            coordinates: [26.244361, 55.732]
        },
        alt: {
            lt: "Tūkstantmečio tiltas",
            en: "Millenium Bridge",
            coordinates: [24.04095, 54.42128]
        },
        mzk: {
            lt: "Juodpelkio parkas (III)",
            en: "Juodpelkio Park (III)",
            coordinates: [22.338881, 56.295645]
        },
    },
    {
        lt: "Žaliai fluorescuojantis baltymas",
        en: "Green fluorescent protein",
        link: "gfp",
        vln: {
            lt: "Katedros aikštė",
            en: "Cathedral Square",
            coordinates: [25.288243, 54.685297],
        },
        kns: {
            lt: "Rotušė",
            en: "Town Hall",
            coordinates: [23.88581, 54.8973]
        },
        klp: {
            lt: "Meridianas",
            en: "Sailboat Meridian",
            coordinates: [21.134859, 55.710149]
        },
        sil: {
            lt: "Prisikėlimo aikštė",
            en: "Resurrection Square",
            coordinates: [23.3162558, 55.9331288],
        },
        pnv: {
            lt: "Muzikinis teatras",
            en: "Musical Theatre",
            coordinates: [24.35699, 55.72581]
        },
        trg: {
            lt: "Liberty Beach",
            en: "Liberty Beach",
            coordinates: [22.318530, 55.237838]
        },
        rtv: {
            lt: "Anikės aikštė",
            en: "Anikės Square",
            coordinates: [21.932608, 55.723778]
        },
        zrs: {
            lt: "Sėlių aikštė (II)",
            en: "Sėliai Square (II)",
            coordinates: [26.244361, 55.732000]
        },
        alt: {
            lt: "Dailidės ežeras",
            en: "Dailidė Lake",
            coordinates: [24.07707, 54.3855]
        },
        mzk: {
            lt: "Šv. Pranciškaus Asyžiečio bažnyčios aikštėle",
            en: "Church of St. Francis and St. Bernard Square",
            coordinates: [22.338646, 56.303939]
        },
    },
    {
        lt: "Genetiškai modifikuoti organizmai",
        en: "Genetically modified organisms",
        link: "gmo",
        vln: {
            lt: "Užupio undinė",
            en: "Mermaid of Užupis",
            coordinates: [25.292648, 54.680584],
        },
        kns: {
            lt: "Centrinis paštas",
            en: "Central Post Office",
            coordinates: [23.9045, 54.89793]
        },
        klp: {
            lt: "Klaipėdos pilis",
            en: "Klaipėda Castle",
            coordinates: [21.12892, 55.70583]
        },
        sil: {
            lt: "Kaštonų alėja",
            en: "Kaštonų Alley",
            coordinates: [23.3101301, 55.9344033],
        },
        pnv: {
            lt: "Dailės galerija",
            en: "Art Gallery",
            coordinates: [24.35979, 55.72793]
        },
        trg: {
            lt: "Vytauto stadionas",
            en: "Vytautas Stadium",
            coordinates: [22.278648, 55.260828]
        },
        rtv: {
            lt: "Malūno tvenkinio salelė",
            en: "Island of the Windmill Pond",
            coordinates: [21.931575, 55.727031]
        },
        zrs: {
            lt: "Zarasų krašto muziejus",
            en: "Zarasai Region Museum",
            coordinates: [26.245028, 55.728278]
        },
        alt: {
            lt: "Jaunimo parkas (I)",
            en: "Youth Park (I)",
            coordinates: [24.03019, 54.40527]
        },
        mzk: {
            lt: "Senamiesčio parkas (III)",
            en: "Old Town Park (III)",
            coordinates: [22.347766, 56.316446]
        },
    },
    {
        lt: "Bakteriofagas",
        en: "Bacteriophage",
        link: "nano",
        vln: {
            lt: "Trijų kryžių kalnas",
            en: "Hill of Three Crosses",
            coordinates: [25.297490, 54.686754],
        },
        kns: {
            lt: "Vytauto parkas",
            en: "Vytautas Park",
            coordinates: [23.92976, 54.89683]
        },
        klp: {
            lt: "Kultūros fabrikas",
            en: "Culture Factory",
            coordinates: [21.14116, 55.70782]
        },
        sil: {
            lt: "Fontanas „Pelikanai“",
            en: "Fountain \"Pelicans\"",
            coordinates: [23.314924, 55.931415],
        },
        pnv: {
            lt: "Juozo Miltinio teatras",
            en: "Juozas Miltinis Drama Theater",
            coordinates: [24.36456, 55.72889]
        },
        trg: {
            lt: "Zumpės tvenkinys",
            en: "Zumpės Pond",
            coordinates: [22.305646, 55.252937]
        },
        rtv: {
            lt: "Prie vasaros estrados",
            en: "By the Summer Stage",
            coordinates: [21.941778, 55.728632]
        },
        zrs: {
            lt: "Bajorų gatvė (I)",
            en: "Bajorai street (I)",
            coordinates: [26.240861, 55.732083]
        },
        alt: {
            lt: "Rotušė",
            en: "Town Hall",
            coordinates: [24.04921, 54.39623]
        },
        mzk: {
            lt: "Pavenčių paplūdimys (I)",
            en: "Pavenčiai Beach (I)",
            coordinates: [22.332374, 56.293762]
        },
    },
    {
        lt: "Sekvenavimas",
        en: "Sequencing",
        link: "sequencing",
        vln: {
            lt: "Rotušės aikštė",
            en: "Town Hall Square",
            coordinates: [25.287631, 54.679236],
        },
        kns: {
            lt: "Kiemo galerija",
            en: "Yard Gallery",
            coordinates: [23.90479, 54.89937]
        },
        klp: {
            lt: "„Juodasis vaiduoklis“",
            en: "\"Black Ghost\" Sculpture",
            coordinates: [21.126767, 55.706624]
        },
        sil: {
            lt: "Geležinkelio stotis",
            en: "Railway Station",
            coordinates: [23.3139713, 55.9234364],
        },
        pnv: {
            lt: "Senoji siauruko stotis",
            en: "Old Narrow Gauge Station",
            coordinates: [24.35861, 55.74599]
        },
        trg: {
            lt: "Tauragės kultūros centras",
            en: "Tauragė Culture Centre",
            coordinates: [22.283158, 55.251710]
        },
        rtv: {
            lt: "Naujasis pažintinis takelis",
            en: "New Cognitive Path",
            coordinates: [21.937548, 55.727696]
        },
        zrs: {
            lt: "Bajorų gatvė (III)",
            en: "Bajorai Street (III)",
            coordinates: [26.241167, 55.733306]
        },
        alt: {
            lt: "Jaunimo parkas (II)",
            en: "Youth Park (II)",
            coordinates: [24.02786, 54.40656]
        },
        mzk: {
            lt: "Sodų skverelis (I)",
            en: "Gardens Square (I)",
            coordinates: [22.335150, 56.308655]
        },
    },
    {
        lt: "Modeliniai organizmai",
        en: "Model organisms",
        link: "ecoli",
        vln: {
            lt: "Baltasis tiltas",
            en: "White Bridge",
            coordinates: [25.273619, 54.693303],
        },
        kns: {
            lt: "Nemuno sala",
            en: "Nemunas Island",
            coordinates: [23.91045, 54.89159]
        },
        klp: {
            lt: "„Baltijos-banga“",
            en: "\"Baltijos-banga\"",
            coordinates: [21.132110, 55.708681]
        },
        sil: {
            lt: "Talkšos paplūdimys",
            en: "Talkša Beach",
            coordinates: [23.336872, 55.932422],
        },
        pnv: {
            lt: "Kino centras „Garsas“",
            en: "Cinema centre \"Garsas\"",
            coordinates: [24.35999, 55.73179]
        },
        trg: {
            lt: "Jaunimo erdvė",
            en: "Youth Space",
            coordinates: [22.277341, 55.260298]
        },
        rtv: {
            lt: "Naujasis tiltelis",
            en: "The New Bridge",
            coordinates: [21.942132, 55.730166]
        },
        zrs: {
            lt: "Bajorų gatvė (II)",
            en: "Bajorai Street (II)",
            coordinates: [26.240861, 55.732556]
        },  
        alt: {
            lt: "Senamiesčio skveras",
            en: "Old Town Square",
            coordinates: [24.04895, 54.39915]
        },
        mzk: {
            lt: "Pavenčių paplūdimys (II)",
            en: "Pavenčiai Beach (II)",
            coordinates: [22.330539, 56.292643]
        },
    },
    {
        lt: "Crispr-Cas9",
        en: "Crispr-Cas9",
        link: "crisprcas9",
        vln: {
            lt: "Bernardin&uogon; sodas (II)",
            en: "Bernardine Garden (II)",
            coordinates: [25.296628, 54.682367],
        },
        kns: {
            lt: "Kauko laiptai",
            en: "Kaukas Steps",
            coordinates: [23.92547, 54.90095]
        },
        klp: {
            lt: "„Vaikystės svajonė“",
            en: "\"Childhood Dream\" Sculpture",
            coordinates: [21.122211, 55.705501]
        },
        sil: {
            lt: "P. Višinsio biblioteka",
            en: "P. Višinskis Library",
            coordinates: [23.3106477, 55.9371334],
        },
        pnv: {
            lt: "Kultūros ir poilsio parkas",
            en: "Culture and Leisure Park",
            coordinates: [24.3356, 55.73761]
        },
        trg: {
            lt: "Vasaros estrada",
            en: "Summer Stage",
            coordinates: [22.280272, 55.244419]
        },
        rtv: {
            lt: "Muziejus",
            en: "Museum",
            coordinates: [21.931111, 55.728413]
        },
        zrs: { 
            lt: "Bajorų gatvė (IV)",
            en: "Bajorai Street (IV)",
            coordinates: [26.240500, 55.733889]
        },
        alt: {
            lt: "Dailidės ežeras (II)",
            en: "Dailidė Lake (II)",
            coordinates: [24.07503, 54.3865]
        },
        mzk: {
            lt: "Sodų skverelis (II)",
            en: "Gardens Square (II)",
            coordinates: [22.332365, 56.309574]
        },
    },
    {
        lt: "Transliacija",
        en: "Translation",
        link: "translation",
        vln: {
            lt: "Vokiečių gatvė",
            en: "Vokiečių Street",
            coordinates: [25.283881, 54.679338],
        },
        kns: {
            lt: "Soboras",
            en: "Garrison Church",
            coordinates: [23.92147, 54.89704]
        },
        klp: {
            lt: "Melnragės molas",
            en: "Melnragė Pier",
            coordinates: [21.085865, 55.731250]
        },
        sil: {
            lt: "Chaimo Frenkelio vila",
            en: "Chaimas Frenkelis Villa",
            coordinates: [23.3287166, 55.9252816],
        },
        pnv: {
            lt: "Senvagė",
            en: "Old Riverbed",
            coordinates: [24.36375, 55.73062]
        },
        trg: {
            lt: "Riedlenčių parkas",
            en: "Skatepark",
            coordinates: [22.291550, 55.252889]
        },
        rtv: {
            lt: "Šv. Mykolo Arkangelo bažnyčia",
            en: "Church of St. Michael",
            coordinates: [21.933069, 55.723338]
        },
        zrs: {
            lt: "Sėlių aikštė (I)",
            en: "Sėliai Square (I)",
            coordinates: [26.245722, 55.731722]
        },
        alt: {
            lt: "Laisvės Angelas",
            en: "Angel of Freedom",
            coordinates: [24.04947, 54.39404]
        },
        mzk: {
            lt: "Mažeikių kultūros centro aikštelė",
            en: "Mažeikiai Culture Centre Square",
            coordinates: [22.339286, 56.304385]
        },
    },
    {
        lt: "Virusai",
        en: "Viruses",
        link: "virus",
        vln: {
            lt: "MO muziejus",
            en: "MO Museum",
            coordinates: [25.277759, 54.679589],
        },
        kns: {
            lt: "Aleksoto apžvalgos aikštelė",
            en: "Aleksotas Observation Point",
            coordinates: [23.88653, 54.89161]
        },
        klp: {
            lt: "M. Mažvydo alėja",
            en: "M. Mažvydas Alley",
            coordinates: [21.132862, 55.714552]
        },
        sil: {
            lt: "Savivaldybės aikštė",
            en: "Municipality Square",
            coordinates: [23.3180374, 55.9321064],
        },
        rtv: {
            lt: "Naujasis pažintinis takelis",
            en: "The New Hiking Trail",
            coordinates: [21.937548, 55.727696]
        },
        pnv: {
            lt: "Lėlių vežimo tetras",
            en: "Puppet Wagon Theater",
            coordinates: [24.36045, 55.73086]
        },
        trg: {
            lt: "Autobusų stotis",
            en: "Bus Station",
            coordinates: [22.292393, 55.255545]
        },
        rtv: {
            lt: "Meilės kalnelis",
            en: "Hill of Love",
            coordinates: [21.934343, 55.731145]
        },
        zrs: {
            lt: "Zarasų bažnyčia",
            en: "Zarasai Catholic Church",
            coordinates: [26.245444, 55.730889]
        },
        alt: {
            lt: "Mažosios Dailidės ežeras",
            en: "Little Dailidė Lake",
            coordinates: [24.06095, 54.3927]
        },
        mzk: {
            lt: "Mažeikių Merkelio Račkausko gimnazija",
            en: "Mažeikiai Merkelio Račkausko gymnasium",
            coordinates: [22.347358, 56.311710]
        },
    },
];
let cities = {
    vln: {
        coordinates: [25.2855, 54.687],
        zoom: 13
    },
    kns: {
        coordinates: [23.907, 54.89721],
        zoom: 12.45
    },
    klp: {
        coordinates: [21.11, 55.70583],
        zoom: 11.9
    },
    sil: {
        coordinates: [23.319, 55.932106],
        zoom: 12.7
    },
    pnv: {
        coordinates: [24.355265, 55.731426],
        zoom: 13
    },
    trg: {
        coordinates: [22.299, 55.25],
        zoom: 12.5
    },
    alt: {
        coordinates: [24.055, 54.399],
        zoom: 12.2
    },
    rtv: {
        coordinates: [21.936, 55.726798],
        zoom: 14.4
    },
    zrs: {
        coordinates: [26.239, 55.732083],
        zoom: 14
    },
    mzk: {
        coordinates: [22.341217, 56.311901],
        zoom: 14
    }
}

function initializeNavBar(language) {

    var els = document.querySelectorAll('#dropdown-content :not(.navbar-contr):not(#navbar-controls):not(img):not(.languageBox):not(h1):not(span)');
    console.log(els);

    for (var i = 0; i < els.length; i++) {
        els[i].parentNode.removeChild(els[i])
    }
    var sortedPointList = points;
    sortedPointList.sort((a, b) => {
        if (a[language] < b[language])
            return -1;
        if (a[language] > b[language])
            return 1;
        return 0;
    })
    points.forEach(function (point) {
        var cityCookie = document.cookie.split('; ').find(row => row.startsWith('city'))
            .split('=')[1];
        var a = document.createElement('a');
        a.setAttribute("href", './ar.html?model=' + point.link + '&city=' + cityCookie);
        a.innerHTML = point[language];
        document.getElementById("dropdown-content").appendChild(a);
    })
}

function makeFeatures(city, language) {
    var cityCookie = document.cookie.split('; ')
        .find(row => row.startsWith('city'))
        .split('=')[1];
    let returnList = [];
    for (let item of points) {
        let theLink;
        if (typeof (item.customLink) === 'string') {
            theLink = item.customLink;
        } else {
            theLink = './ar.html?model=' + item.link + '&city=' + cityCookie;
        }

        returnList.push({
            'type': 'Feature',
            'properties': {
                'description': '<p><a href="' + theLink + '">' + item[city][language] + '</a></p>'
            },
            'geometry': {
                'type': 'Point',
                'coordinates': item[city].coordinates
            }
        });
    }
    return returnList;
}

mapboxgl.setRTLTextPlugin('https://cdn.maptiler.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.1.2/mapbox-gl-rtl-text.js');

function loadMap(city, language) {
    if (!mapboxgl.supported()) {
        alert('Your browser does not support Mapbox GL');
    } else {
        mapboxgl.accessToken = 'pk.eyJ1IjoiaWdlbXZpbG5pdXMiLCJhIjoiY2s4b2tuM3ZmMDNmMDNlbnNyNjBjYmF6byJ9.awDMKTb7QstzkFAD3FPA-g';
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'https://api.maptiler.com/maps/565e5c8b-5c56-489b-b954-0f260bfa40eb/style.json?key=dh3avbXkPzMlI59PVFsz',
            center: cities[city].coordinates,
            zoom: cities[city].zoom
        });

        map.on('load', function () {
            map.loadImage('images/map-target.png', function (error, image) {
                if (error) throw error;
                map.addImage('map-target', image);
                map.addSource('stations', {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': makeFeatures(city, language),
                    }

                });
                // Add a layer showing the places.
                map.addLayer({
                    'id': 'stations-layer',
                    'type': 'symbol',
                    'source': 'stations',
                    'layout': {
                        'icon-image': 'map-target',
                        'icon-allow-overlap': true,
                        'icon-size': 0.07,
                        'icon-anchor': "bottom"
                    }
                });
                map.on('click', 'stations-layer', function (e) {
                    var coordinates = e.features[0].geometry.coordinates.slice();
                    var description = e.features[0].properties.description;
                    while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                        coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                    }

                    new mapboxgl.Popup()
                        .setLngLat(coordinates)
                        .setHTML(description)
                        .addTo(map);
                });
                map.on('mouseenter', 'places', function () {
                    map.getCanvas().style.cursor = 'pointer';
                });
                map.on('mouseleave', 'places', function () {
                    map.getCanvas().style.cursor = '';
                });
            });


        });
    }

}

function changeLanguage() {
    var lang = LanguageSwitcher.currentLanguage
    var cityM = document.cookie.split('; ')
        .find(row => row.startsWith('city'))
        .split('=')[1];
    loadMap(cityM, lang)
    initializeNavBar(lang);
}

LanguageSwitcher.makeLanguageBox(document.getElementById("language"), 0);
LanguageSwitcher.addOnLanguageChangeListener(changeLanguage);


window.onresize = () => {
    if (navOpen) return;
    if (window.innerWidth > 768) {
        navBar.style.right = "-33vw";
    } else {
        navBar.style.right = "-66vw";
    }
};

let navBar = document.getElementById("dropdown-content");
let footerButton = document.getElementById("footer");

var navOpen = false;

function openNav() {
    if (navOpen) return;
    navOpen = true;
    navBar.style.right = "0";
    footerButton.style.bottom = "-100px";
}

function closeNav() {
    if (!navOpen) return;
    navOpen = false;
    if (window.innerWidth > 768) {
        navBar.style.right = "-33vw";
    } else {
        navBar.style.right = "-66vw";
    }
    footerButton.style.bottom = "0";
}
var city;

var cookieExists = document.cookie.split('; ')
    .find(row => row.startsWith('city'));
if (cookieExists != undefined) {
    city = document.cookie.split('; ')
        .find(row => row.startsWith('city'))
        .split('=')[1];
}

function chooseCity() {
    document.getElementById("dropdown-menu").style.display = "none";
    document.getElementById("change-city").style.display = "none";
    var cityButtons = document.getElementsByClassName("city-button");
    var cityMain;
    for (var i = 0; i < cityButtons.length; i++) {
        document.getElementById(cityButtons[i].id).addEventListener('click', function (ev) {
            document.getElementById("change-city").style.display = "initial";
            document.getElementById("choose-city").style.display = "none";
            document.getElementById("dropdown-menu").style.display = "initial";
            cityMain = ev.target.id
            document.cookie = "city=" + cityMain;
            initializeNavBar(LanguageSwitcher.currentLanguage);
            city = cityMain;
            loadMap(cityMain, LanguageSwitcher.currentLanguage)
        })
    }
}
if (city == undefined) {
    chooseCity();
} else {
    document.getElementById("choose-city").style.display = "none";
    document.getElementById("change-city").style.display = "initial";
    initializeNavBar(LanguageSwitcher.currentLanguage);
    loadMap(city, LanguageSwitcher.currentLanguage)
}
document.getElementById("change-city-icon").addEventListener('click', function () {
    var node = document.getElementById("map");
    node.querySelectorAll('*').forEach(n => n.remove());
    document.getElementById("choose-city").style.display = "initial";
    chooseCity();
})
