<!DOCTYPE html>
<html>

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <title>Vilnius iGEM AR</title>
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-163985569-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-163985569-1');
    </script>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://cdn.maptiler.com/mapbox-gl-js/v1.5.1/mapbox-gl.js"></script>
    <link href="https://cdn.maptiler.com/mapbox-gl-js/v1.5.1/mapbox-gl.css" rel="stylesheet" />
    <!-- Bootstrap core CSS -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="./css/main.css" rel="stylesheet">
</head>

<body>
    <div id="dropdown-menu"><img onclick="openNav()" id="dropdown-icon" src="images/menu.svg">
    </div>
    <div id="dropdown-content">
        <div id="navbar-controls">
            <div class="navbar-contr" id="language"></div>
            <div class="navbar-contr" id="close"><img id="close-img" onclick="closeNav()" src="images/close-light.svg"></div>
        </div>
    </div>

    <div id="map" onclick="closeNav()"></div>
    <main role="main" class="inner cover"><a href="/" id="foot" class="btn btn-lg btn-secondary">gr&iogon;&zcaron;ti atgal</a><br></main>

    <script src="js/languages.js" charset="UTF-8"></script>
    <script>
        /*
        ---kol kas nereikalingos stotelės--
        { title: "Baltasis tiltas", coordinates: [25.272992, 54.692972], link: "bioethics", },
        { title: "U&zcaron;upio angelas", coordinates: [25.295431, 54.680630], link: "e621", },
        { title: "Vilniaus Universitetas", coordinates: [25.287624, 54.682960], link: "fish", }
        */
        let pointList = [{
                lt: {
                    title: "Katedros aik&scaron;t&edot;",
                    menuTitle: "DNR"
                },
                en: {
                    title: "Cathedral Square",
                    menuTitle: "DNA"
                },
                coordinates: [25.288243, 54.685297],
                link: "dna",

            },
            {
                lt: {
                    title: "Daukanto aik&scaron;t&edot;",
                    menuTitle: "RNR"
                },
                en: {
                    title: "??? Square",
                    menuTitle: "RNA"
                },
                coordinates: [25.288991, 54.688194],
                link: "rna",
            },
            {
                lt: {
                    title: "Vingio parkas (I)",
                    menuTitle: "Genetinė grandinė"
                },
                en: {
                    title: "Vingis park (I)",
                    menuTitle: "Genetic circuit"
                },
                coordinates: [25.248680, 54.682399],
                link: "circuit",
            },
            {
                lt: {
                    title: "Vingio parkas (III)",
                    menuTitle: "Biobrick"
                },
                en: {
                    title: "Vingis park (III)",
                    menuTitle: "Biobrick"
                },
                coordinates: [25.236457, 54.682373],
                link: "biobrick",
            },
            {
                lt: {
                    title: "Trij&uogon; kry&zcaron;i&uogon; kalnas",
                    menuTitle: "Crispr-Cas9"
                },
                en: {
                    title: "Three Crosses Hill",
                    menuTitle: "Crispr-Cas9"
                },
                coordinates: [25.297490, 54.686754],
                link: "crisprcas9",
            },
            {
                lt: {
                    title: "Bernardin&uogon; sodas (I)",
                    menuTitle: "Žaliai fluorescuojantis baltymas"
                },
                en: {
                    title: "??? park (I)",
                    menuTitle: "Green fluorescent protein"
                },
                coordinates: [25.297362, 54.683689],
                link: "gfp",
            },
            {
                lt: {
                    title: "Vinco Kudirkos aik&scaron;t&edot;",
                    menuTitle: "Genetiškai modifikuoti organizmai"
                },
                en: {
                    title: "Vincas Kudirka square",
                    menuTitle: "Genetically modified organisms"
                },
                coordinates: [25.280564, 54.687349],
                link: "gmo",
            },
            {
                lt: {
                    title: "U&zcaron;upio undin&edot;",
                    menuTitle: "Sekvenavimas"
                },
                en: {
                    title: "U&zcaron;upis Mermaid",
                    menuTitle: "Sequencing"
                },
                coordinates: [25.292648, 54.680584],
                link: "sequencing",
            },
            {
                lt: {
                    title: "Luki&scaron;ki&uogon; aik&scaron;t&edot;",
                    menuTitle: "Bakteriofagas"
                },
                en: {
                    title: "Luki&scaron;ki&uogon; Square",
                    menuTitle: "Bacteriophage"
                },
                coordinates: [25.271029, 54.689640],
                link: "nano",
            },
            {
                lt: {
                    title: "Bernardin&uogon; sodas (II)",
                    menuTitle: "Modeliniai organizmai"
                },
                en: {
                    title: "Bernardinai park (II)",
                    menuTitle: "Model organisms"
                },
                coordinates: [25.296628, 54.682367],
                link: "ecoli",
            },
            {
                lt: {
                    title: "Vingio parkas (IV)",
                    menuTitle: "Sintetinė Biologija"
                },
                en: {
                    title: "Vingis park (IV)",
                    menuTitle: "Synthetic Biology"
                },
                coordinates: [25.232576, 54.683055],
                link: "painting",
            },
            {
                lt: {
                    title: "Sirvydo skveras",
                    menuTitle: "Transliacija"
                },
                en: {
                    title: "Sirvydas Square",
                    menuTitle: "Translation"
                },
                coordinates: [25.303095, 54.692732],
                link: "translation",
            },
            {
                lt: {
                    title: "MO muziejus",
                    menuTitle: "Virusai"
                },
                en: {
                    title: "MO museum",
                    menuTitle: "Viruses"
                },
                coordinates: [25.277759, 54.679589],
                link: "virus",
            },
        ];



        function initializeNavBar(language) {
            var els = document.querySelectorAll('#dropdown-content :not(.navbar-contr):not(#navbar-controls):not(img):not(.languageBox)');
            console.log(els)
            for (var i = 0; i < els.length; i++) {
                els[i].parentNode.removeChild(els[i])
            }
            pointList.forEach(function(point) {
                var a = document.createElement('a');
                a.setAttribute("href", './ar.html?model=' + point.link);
                a.innerHTML = point[LanguageSwitcher.currentLanguage].menuTitle;
                document.getElementById("dropdown-content").appendChild(a);
            })
        }

        function makeFeatures(language) {
            let returnList = [];
            for (let item of pointList) {
                let theLink;
                if (typeof(item.customLink) === 'string') {
                    theLink = item.customLink;
                } else {
                    theLink = './ar.html?model=' + item.link;
                }

                returnList.push({
                    'type': 'Feature',
                    'properties': {
                        'description': '<p><a href="' + theLink + '">' + item[language].title + '</a></p>'
                    },
                    'geometry': {
                        'type': 'Point',
                        'coordinates': item.coordinates
                    }
                });
            }
            console.log(returnList)
            return returnList;
        }



        // You can remove the following line if you don't need support for RTL (right-to-left) labels:
        mapboxgl.setRTLTextPlugin('https://cdn.maptiler.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.1.2/mapbox-gl-rtl-text.js');
        if (!mapboxgl.supported()) {
            alert('Your browser does not support Mapbox GL');
        } else {
            mapboxgl.accessToken = 'pk.eyJ1IjoiaWdlbXZpbG5pdXMiLCJhIjoiY2s4b2tuM3ZmMDNmMDNlbnNyNjBjYmF6byJ9.awDMKTb7QstzkFAD3FPA-g';
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'https://api.maptiler.com/maps/565e5c8b-5c56-489b-b954-0f260bfa40eb/style.json?key=dh3avbXkPzMlI59PVFsz',
                //center: [25.27989, 54.68842],
                //zoom: 13.45
            });
            map.on('load', function() {
                map.loadImage('images/map-target.png', function(error, image) {
                    if (error) throw error;
                    map.addImage('map-target', image);
                    map.addSource('stations-Vln', {
                        'type': 'geojson',
                        'data': {
                            'type': 'FeatureCollection',
                            'features': makeFeatures(LanguageSwitcher.currentLanguage),
                        }

                    });
                    // Add a layer showing the places.
                    map.addLayer({
                        'id': 'stations',
                        'type': 'symbol',
                        'source': 'stations-Vln',
                        'layout': {
                            'icon-image': 'map-target',
                            'icon-allow-overlap': true,
                            'icon-size': 0.4,
                            'icon-anchor': "bottom"
                        }
                    });
                    console.log(map.style._layers.stations)
                    map.on('click', 'stations', function(e) {
                        var coordinates = e.features[0].geometry.coordinates.slice();
                        var description = e.features[0].properties.description;
                        while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
                        }

                        new mapboxgl.Popup()
                            .setLngLat(coordinates)
                            .setHTML(description)
                            .addTo(map);
                    });
                    map.on('mouseenter', 'places', function() {
                        map.getCanvas().style.cursor = 'pointer';
                    });
                    map.on('mouseleave', 'places', function() {
                        map.getCanvas().style.cursor = '';
                    });
                });

                function updateTexts(language) {
                    initializeNavBar(language)
                    //TODO: change languages on map and 'go back' buttons
                    var layers = map.style._layers
                    console.log(layers)
                }
                updateTexts(LanguageSwitcher.currentLanguage);
                LanguageSwitcher.makeLanguageBox(document.getElementById("language"), 0);
                LanguageSwitcher.addOnLanguageChangeListener(updateTexts);
            });
        }

        function openNav() {
            document.getElementById("dropdown-content").style.width = "66vw";
            document.getElementById("foot").style.height = "0px";
            document.getElementById("foot").style.padding = "0";
        }

        function closeNav() {
            var navBar = document.getElementById("dropdown-content");
            if (navBar.style.width != "") {
                navBar.style.width = "0px";
                document.getElementById("foot").style.height = "initial";
                document.getElementById("foot").style.padding = "12px 20px 12px 20px";
            }
        }


        document.addEventListener('load', initializeNavBar(LanguageSwitcher.currentLanguage));
    </script>
</body></html>
